(function(){console.log("nanospell - load");var p=!1,h,v,q=!1,r="en";CKEDITOR.plugins.add("nanospell",{icons:"nanospell",init:function(c){function D(a,b){var d=b+"icons/nanospell.png";if(a.contextMenu){var e=function(b,e,c,g){return{label:b,icon:e?d:null,group:"nano",onClick:function(){if(-1<b.indexOf(String.fromCharCode(160)))return window.open("http://ckeditor-spellcheck.nanospell.com/license?discount\x3ddeveloper_max");var d=document.createElement("textarea");d.innerHTML=b;a.insertText(d.value);
g.$.className="nanospell-typo-disabled"}}},c=function(){var b=a.getSelection().getStartElement(),d=a.createRange();d.selectNodeContents(b);d.enlarge();d.optimize();d.select();return b.getText()};a.addMenuGroup("nano",-30);a.addMenuGroup("nanotools",-29);a.contextMenu.hasNanoListener||(a.contextMenu.addListener(function(b){if(b.$&&b.$.className&&"span"==b.$.nodeName.toLowerCase()&&"nanospell-typo"===b.$.className){var f=c(),l={},m=Q(f);if(m){if(0==m.length)a.addMenuItem("nanopell_nosug",{label:"( No Spelling Suggestions )",
icon:d,group:"nano"}),l.nanopell_nosug=CKEDITOR.TRISTATE_DISABLED;else for(var k=0;k<m.length;k++){var h=m[k];1>h.replace(/^\s+|\s+$/g,"").length||(a.addMenuItem("nanopell_sug_"+k,e(h,!k,f,b)),l["nanopell_sug_"+k]=CKEDITOR.TRISTATE_OFF)}a.addMenuItem("nanopell_ignore",{label:"Ignore",group:"nanotools",onClick:function(){E(b.$,f,!0)}});l.nanopell_ignore=CKEDITOR.TRISTATE_OFF;localStorage&&(a.addMenuItem("nanopell_learn",{label:"Add To Personal Dictionary",group:"nanotools",onClick:function(){var a=
localStorage.getItem("nano_spellchecker_personal"),a=null!==a&&""!==a?a+String.fromCharCode(127):"",a=a+f.toLowerCase();localStorage.setItem("nano_spellchecker_personal",a);E(b.$,f,!0)}}),l.nanopell_learn=CKEDITOR.TRISTATE_OFF);return l}}}),a.contextMenu.hasNanoListener=!0)}else setTimeout(function(){D(a,b)},100)}function y(){(c.getSelection()?0==c.getSelection().getSelectedText().length:1)&&q&&u()}function F(){return c.getSelection()?c.getSelection().getStartElement():null}function R(a){var b=S(),
d='{"id":"c0","method":"spellcheck","params":{"lang":"'+r+'","words":["'+a.join('","')+'"]}}';T(b,d,function(b){try{var d=JSON.parse(b)}catch(c){b="Nanospell need to be installed correctly before use (server:"+h.server+").\n\nPlease run nanospell/getstarted.html. ",0>window.location.href.indexOf("nanospell/")?console.log(b):confirm(b)&&(window.location=v+"../getstarted.html")}var d=d.result,f;for(f in a)b=a[f],d[b]?(n[b]=d[b],z[b]=!1):z[b]=!0;G();200<=a.length&&y()})}function T(a,b,d){var c=new XMLHttpRequest;
if(!c)return null;c.open("POST",a,!0);c.onreadystatechange=function(){4==c.readyState&&(200<=c.status&&300>c.status||304==c.status||0===c.status||1223==c.status)&&(d(c.responseText),c=null)};c.send(b);return!0}function S(){var a=h.server,b=v,b=b+"../";"undefined"==typeof a&&(a="php");a=a.toLowerCase();switch(a){case ".net":return b+"server/ajax/asp.net/tinyspell.aspx";case "asp.net":return b+"server/ajax/asp.net/tinyspell.aspx";case "net":return b+"server/ajax/asp.net/tinyspell.aspx";case "asp":return b+
"server/ajax/asp/tinyspell.asp";default:return b+"server/ajax/php/tinyspell.php"}}function G(){if((!window.getSelection||!c.getWin().getSelection().toString())&&q){if(window.getSelection&&p){var a=c.getWin().getSelection().getRangeAt(0);a.deleteContents();a.insertNode(c.getDoc().createTextNode(w))}c.getWin().getSelection?a=null:(a=c.getDoc().selection.createRange().duplicate(),a={x:a.boundingLeft,y:a.boundingTop});H(c.getBody());I(c.getBody());var b;a:if(c.getWin().getSelection){if(p){b=x(c.getBody());
for(var d=null,e=null,g=0;g<b.length;g++)if(-1<b[g].data.indexOf(w)){e=b[g];d=b[g].data.indexOf(w);b[g].data=b[g].data.replace(w,"");b={node:e,offset:d};break a}}b=void 0}else b=null;d=c.getBody();d=x(d);for(e=0;e<d.length;e++){var t=d[e],g=J();"".match(g);for(var f=t,l=void 0,t=[t];null!=(l=g.exec(f.data));){var m=l[0].replace("\x26#8203;","");if(K(m)&&"object"===typeof n[A(m)]){var k=l.index,l=l=m.length,k=f.splitText(k),h=c.getDoc().createElement("span");h.className="nanospell-typo";h.setAttribute("data-cke-bogus",
!0);m=c.getDoc().createTextNode(m);h.appendChild(m);f.parentNode.insertBefore(h,k);k.data=k.data.substr(l);f=k;t.push(m);t.push(k);"".match(g)}}}if(c.getWin().getSelection&&p&&b){d=null;e=x(c.getBody());g=b.node;b=b.offset;for(f=0;f<e.length;f++)e[f]==g&&(d=f);if(null!==d){for(f=d;f<e.length-1&&!(b<=e[f].data.length);f++)b-=e[f].data.length,g=e[f+1];d=g;e=c.getWin().getSelection();e.getRangeAt&&e.rangeCount&&(g=e.getRangeAt(0),g.collapse(!0),g.setStart(d,b),g.setEnd(d,b),e.removeAllRanges(),e.addRange(g))}}d=
a;c.getWin().getSelection||0===d.x||0===d.y||(b=c.getDoc(),a=d.x,d=d.y,b=b.body.createTextRange(),b.moveToPoint(a,d),b.select());c.fire("SpellcheckStart");c.nanospellstarted=!0}}function H(a){for(var b,d,e=!1;!e;)for(e=!0,d=c.getDoc().getElementsByTagName("span"),a=d.length;a--;)if(b=d[a],"nanospell-typo"==b.className||"nanospell-typo-disabled"==b.className)b.outerHTML=b.innerHTML.replace("\x26#8203;",""),e=!1}function I(a){if(L())for(var b=a.firstChild,d;b;){if(3==b.nodeType)for(;(d=b.nextSibling)&&
3==d.nodeType;)b.appendData(d.data),a.removeChild(d);else I(b);b=b.nextSibling}else a.normalize()}function L(){var a=navigator.userAgent.toLowerCase();return-1<a.indexOf("msie")||-1<a.indexOf("trident")||-1<a.indexOf(".net clr")}function J(a){if(!a&&B)return B;if(a&&C)return C;var b='\\s!"#$%\x26()*+,-.â€¦/:;\x3c\x3d\x3e?@[\\]^_{|}`​§©«®±¶·¸»¼½¾¿×÷¤”“„‟'+String.fromCharCode(160),b=new RegExp("(\\b[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}\\b)|(\\bhttp[s]?://[a-z0-9#\\._/]{5,}\\b)|(\\bwww.[a-z0-9#._/]{8,128}[a-z0-9/]\\b)|(\x26#d+;)|("+
("[^"+b+"'‘’][^"+b+"]+[^"+b+"'‘’]")+")",a?"":"g");a?C=b:B=b;return b}function x(a){function b(a){for(var c=0;c<a.childNodes.length;c++){var h=a.childNodes[c];if(3==h.nodeType)d.push(h);else{var f=h.nodeName.toLowerCase();"script"!=f&&"style"!=f&&"textarea"!=f&&h.childNodes&&b(h)}}}var d=[];b(a);return d}function A(a){return a.replace(/[\u2018\u2019]/g,"'")}function K(a){if(!a||/\s/.test(a)||/[\:\.\@\/\\]/.test(a)||/^\d+$/.test(a)||1==a.length)return!1;var b=!1!==h.ignore_non_alpha;return!0===h.ignore_block_caps&&
a.toUpperCase()==a||b&&/\d/.test(a)||M[a.toLowerCase()]||U(a)?!1:!0}function U(a){var b=localStorage.getItem("nano_spellchecker_personal");if(null===b||""==b)return!1;b=b.split(String.fromCharCode(127));a=a.toLowerCase();for(var c=0;c<b.length;c++)if(b[c]===a)return!0;return!1}function Q(a){a=A(a);return n[a]&&n[a][0]&&0==n[a][0].indexOf("*")?["nanospell plugin developer trial ","ckeditor-spellcheck.nanospell.com/license "]:n[a]}function E(a,b,d){if(d){1==M[b.toLowerCase()];for(var e in n)e.toLowerCase()==
b.toLowerCase()&&delete n[e];a=c.document.find("span.nanospell-typo").$;for(e=0;e<a.length;e++)d=a[e],(d.innerText||d.textContent)==b&&N(d)}else N(a)}function N(a){var b=a.innerText||a.textContent;L()&&(b=b.replace(/  /g," "+String.fromCharCode(160)));b=c.getDoc().createTextNode(b);a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a)}console.log("nanospell - init");var V=function(a){var b={root:function(a){var b=document.createElement("div");b.innerHTML=a.getHtml();for(var c=b.querySelectorAll("span[data-cke-bogus]"),
d=0;d<c.length;d++){var h=c[d];h.outerHTML=h.innerHTML.replace("\x26#8203;","")}a.setHtml(b.innerHTML)}},c=a.dataProcessor;(c=c&&c.htmlFilter)&&c.addRules(b);clearInterval(a.wiggles_filter_handle)};c.wiggles_filter_handle=setInterval(function(){c.instanceReady&&V(c)},33);v=this.path;c&&!c.config.nanospell&&(c.config.nanospell={});c.getWin=function(){return c.window.$};c.getDoc=function(){return c.document.$};c.getBody=function(){return c.editable().$||c.document.$.body};(h=c.config.nanospell)||(h=
{});r=h.dictionary||r;c.addCommand("nanospell",{exec:function(a){q?O():u()},editorFocus:!0});c.ui.addButton("nanospell",{label:"Spell Checking by Nanospell",command:"nanospell",toolbar:"nanospell",icon:this.path+"icons/nanospell.png"});c.ui.addButton("Nanospell",{label:"Spell Checking by Nanospell",command:"nanospell",toolbar:"Nanospell",icon:this.path+"icons/nanospell.png"});c.on("key",function(a){a=a.data.keyCode;p=!0;if(!(16<=a&&31>=a||37<=a&&40>=a)){var b=F();F&&("nanospell-typo"==b.$.className&&
(b.$.className="nanospell-typo-disabled"),a=32===a||10===a||13===a,c.getSelection()?0==c.getSelection().getSelectedText().length:1)&&(clearTimeout(P),P=setTimeout(y,a?50:250))}});c.on("focus",function(){p=!0});c.on("blur",function(){p=!1});c.on("instanceReady",function(){!1!==h.autostart&&u()});c.on("mode",function(){"wysiwyg"==c.mode&&q&&u();return!0});D(c,this.path);var u=function(){c.getCommand("nanospell").setState(CKEDITOR.TRISTATE_ON);q=!0;var a=v;if(!c.getDoc().getElementById("nanospell_theme")){var b=
c.getDoc().getElementsByTagName("head")[0],d=c.getDoc().createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",a+"/theme/nanospell.css");d.setAttribute("id","nanospell_theme");b.insertBefore(d,b.firstChild)}a:{b="";d=x(c.document.$.body);for(a=0;a<d.length;a++)b+=d[a].data,b=d[a].parentNode&&d[a].parentNode.className&&"nanospell-typo"==d[a].parentNode.className?b+"":b+" ";var b=b.match(J()),d=[],e=[];if(b)for(a=0;a<b.length;a++){var g=A(b[a]);
if(!d[g]&&K(g)&&"undefined"===typeof z[g]&&(e.push(g),d[g]=!0,200<=e.length)){a=e;break a}}a=e}0==a.length?G():R(a)},O=function(){c.getCommand("nanospell").setState(CKEDITOR.TRISTATE_OFF);q=!1;H(c.getBody())};c.stopNanospell=function(){O()};c.startNanospell=function(){u()};var B=null,C=null,z=[],n=[],M=[],w=String.fromCharCode(8)+String.fromCharCode(127)+String.fromCharCode(1),P=null;c.nanospell||(c.nanospell={getLanguage:function(){return r},setLanguage:function(a){r=a;y()}})}})})();